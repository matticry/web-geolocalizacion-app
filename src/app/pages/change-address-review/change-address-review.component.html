<!-- Contenedor principal -->
<div class="flex flex-col md:flex-row gap-8">
    <!-- Cuerpo principal: Panel izquierdo + derecho -->
    <div class="flex flex-1 flex-col lg:flex-row gap-2 sm:gap-4 overflow-hidden min-h-0">
        <!-- Panel Izquierdo - Lista de Solicitudes de Cambio de Dirección -->
        <div class="w-full lg:w-1/4 flex flex-col">
            <div class="flex flex-col flex-1 overflow-hidden h-full bg-white dark:bg-surface-900 border border-surface-200 dark:border-surface-700 rounded-lg shadow-sm">
                <!-- Header + Toolbar -->
                <div class="relative overflow-hidden p-4 bg-gradient-to-br from-orange-50/30 via-amber-50/60 to-yellow-50/20 dark:from-orange-900/20 dark:via-amber-900/30 dark:to-yellow-900/10 rounded-t-lg border-b border-surface-200/60 dark:border-surface-700/60">
                    <!-- Background pattern -->
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-orange-50/20 to-transparent dark:via-orange-900/10"></div>
                    <div class="relative">
                        <!-- Buscador mejorado -->
                        <div class="relative">
                            <input
                                type="text"
                                placeholder="Buscar solicitudes..."
                                (input)="onSearchRequests($event)"
                                class="w-full py-3 pl-11 pr-12 text-sm rounded-xl border-2 border-orange-200/60 dark:border-orange-600/60 bg-gradient-to-r from-white to-orange-50/30 dark:from-surface-800 dark:to-orange-900/20 hover:border-orange-300/70 dark:hover:border-orange-600/70 focus:ring-2 focus:ring-orange-500/30 focus:border-orange-500/80 transition-all duration-200 shadow-sm">

                            <!-- Icono de búsqueda -->
                            <div class="absolute left-3.5 top-1/2 transform -translate-y-1/2">
                                <i class="pi pi-search text-orange-400 dark:text-orange-500"></i>
                            </div>

                            <!-- Botón limpiar -->
                            <button
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 w-6 h-6 flex items-center justify-center text-surface-400 hover:text-orange-500 dark:hover:text-orange-400 transition-colors rounded-full hover:bg-orange-100/60 dark:hover:bg-orange-900/40"
                                title="Limpiar búsqueda">
                                <i class="pi pi-times text-xs"></i>
                            </button>
                        </div>

                        <!-- Información de estado -->
                        @if (filteredCustomers.length > 0 && !loadingCustomers) {
                            <div class="mt-3 flex justify-between items-center text-xs text-surface-600 dark:text-surface-400">
                                <span>{{ filteredCustomers.length }} solicitudes encontradas</span>
                                <div class="flex items-center gap-2">
                                    <span class="inline-flex items-center px-2 py-0.5 rounded-md bg-yellow-100/80 dark:bg-yellow-900/40 text-yellow-700 dark:text-yellow-300 text-xs">
                                        <div class="w-1.5 h-1.5 bg-yellow-500 rounded-full mr-1"></div>
                                        Pendientes
                                    </span>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Contenido Principal -->
                <div class="overflow-hidden flex-1">
                    <!-- Loading Skeleton -->
                    @if (loadingCustomers) {
                        <div class="space-y-3 p-3 max-h-[400px] overflow-y-auto custom-scrollbar">
                            @for (item of [1, 2, 3, 4, 5]; track item) {
                                <div class="rounded-xl border border-surface-200/60 dark:border-surface-700/60 bg-gradient-to-br from-white via-surface-50/50 to-surface-100/20 dark:from-surface-800 dark:via-surface-800/80 dark:to-surface-900/40 p-4">
                                    <div class="flex items-center gap-4">
                                        <!-- Status skeleton -->
                                        <div class="w-3 h-3 rounded-full bg-gradient-to-br from-surface-200 to-surface-300 dark:from-surface-700 dark:to-surface-600 animate-pulse"></div>

                                        <!-- Content skeleton -->
                                        <div class="flex-1 space-y-2">
                                            <div class="h-5 w-32 bg-surface-200 dark:bg-surface-700 rounded animate-pulse"></div>
                                            <div class="h-4 w-24 bg-surface-200 dark:bg-surface-700 rounded animate-pulse"></div>
                                            <div class="h-3 w-16 bg-surface-200 dark:bg-surface-700 rounded animate-pulse"></div>
                                        </div>

                                        <!-- Icon skeleton -->
                                        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-surface-200 to-surface-300 dark:from-surface-700 dark:to-surface-600 animate-pulse"></div>
                                    </div>
                                </div>
                            }
                        </div>
                    }

                    <!-- Lista Real de Solicitudes -->
                    @if (!loadingCustomers) {
                        <div
                            class="space-y-3 p-3 custom-scrollbar"
                            [class]="paginatedCustomers.length > 5 ? 'max-h-[70rem] overflow-y-auto' : ''">

                            @for (request of paginatedCustomers; track request.solid) {
                                <div
                                    class="relative overflow-hidden rounded-xl border border-surface-200/80 dark:border-surface-600/80 bg-gradient-to-br from-white via-surface-50/60 to-surface-100/30 dark:from-surface-700 dark:via-surface-700/90 dark:to-surface-800/60 hover:from-orange-50/40 hover:via-white hover:to-amber-50/30 dark:hover:from-surface-600/80 dark:hover:via-surface-700/60 dark:hover:to-orange-900/20 transition-all duration-300 group hover:shadow-lg hover:border-orange-200/60 dark:hover:border-orange-600/60 hover:-translate-y-0.5 cursor-pointer"
                                    (click)="selectCustomerRequest(request)">

                                    <!-- Background pattern sutil -->
                                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-orange-50/20 to-transparent dark:via-orange-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

                                    <!-- Indicador de estado lateral -->
                                    <div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b"
                                         [class]="request.solapli ? 'from-green-400 to-green-600' : 'from-yellow-400 to-orange-500'"></div>

                                    <!-- Contenido de la solicitud -->
                                    <div class="relative p-4 pl-6">
                                        <div class="flex items-start gap-4">
                                            <!-- Status Badge -->
                                            <div class="relative flex-shrink-0 mt-1">
                                                <div class="w-10 h-10 flex items-center justify-center rounded-xl border transition-all duration-200"
                                                     [class]="request.solapli
                                                     ? 'bg-gradient-to-br from-green-100 via-green-200/50 to-green-300/30 dark:from-green-900/40 dark:via-green-800/60 dark:to-green-700/40 border-green-200/50 dark:border-green-700/50 group-hover:scale-105'
                                                     : 'bg-gradient-to-br from-yellow-100 via-amber-200/50 to-orange-300/30 dark:from-yellow-900/40 dark:via-amber-800/60 dark:to-orange-700/40 border-yellow-200/50 dark:border-yellow-700/50 group-hover:scale-105'">

                                                    @if (request.solapli) {
                                                        <i class="pi pi-check-circle text-green-600 dark:text-green-300 text-lg"></i>
                                                    } @else {
                                                        <i class="pi pi-clock text-amber-600 dark:text-amber-300 text-lg"></i>
                                                    }
                                                </div>

                                                <!-- Indicator dot -->
                                                <div class="absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-white dark:border-surface-800"
                                                     [class]="request.solapli ? 'bg-green-500' : 'bg-yellow-500 animate-pulse'"></div>
                                            </div>

                                            <!-- Info de la Solicitud -->
                                            <div class="flex-1 min-w-0">
                                                <!-- ID y Fecha -->
                                                <div class="flex items-center gap-2 mb-2">
                                            <span class="inline-flex items-center px-2.5 py-1 rounded-lg bg-orange-100/80 dark:bg-orange-900/60 border border-orange-200/60 dark:border-orange-700/60 text-xs font-mono font-bold text-orange-700 dark:text-orange-300">
                                                <i class="pi pi-hashtag mr-1 text-xs"></i>
                                                {{ request.solid }}
                                            </span>
                                                    <span class="text-xs text-surface-500 dark:text-surface-400 font-mono">
                                                {{ request.solfech | date:'dd/MM/yyyy HH:mm' }}
                                            </span>
                                                </div>

                                                <!-- Nombre del cliente -->
                                                <h6 class="font-bold text-surface-900 dark:text-surface-0 mb-2 group-hover:text-orange-700 dark:group-hover:text-orange-300 transition-colors leading-tight">
                                                    {{ request.solnombre }}
                                                </h6>

                                                <!-- Cliente Key -->
                                                <div class="flex items-center gap-2 mb-3">
                                            <span class="inline-flex items-center px-2 py-1 rounded-md bg-surface-100/80 dark:bg-surface-600/60 border border-surface-200/60 dark:border-surface-500/60 text-xs font-mono font-medium text-surface-700 dark:text-surface-300">
                                                <i class="pi pi-user mr-1.5 text-xs"></i>
                                                {{ request.solclave }}
                                            </span>
                                                </div>

                                                <!-- Estado y Usuario -->
                                                <div class="space-y-2">
                                                    <!-- Estado de aplicación -->
                                                    <div class="flex items-center justify-between">
                                                        <div class="flex items-center gap-2">
                                                            @if (request.solapli) {
                                                                <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-green-100/80 dark:bg-green-900/40 text-green-700 dark:text-green-300 text-xs font-medium">
                                                            <i class="pi pi-check mr-1.5 text-xs"></i>
                                                            Cambios aplicados
                                                        </span>
                                                            } @else {
                                                                <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-yellow-100/80 dark:bg-yellow-900/40 text-yellow-700 dark:text-yellow-300 text-xs font-medium">
                                                            <i class="pi pi-exclamation-triangle mr-1.5 text-xs"></i>
                                                            Pendiente de aplicar
                                                        </span>
                                                            }
                                                        </div>

                                                        <!-- Estado activo -->
                                                        @if (request.solact) {
                                                            <div class="flex items-center gap-1">
                                                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                                                                <span class="text-xs text-blue-600 dark:text-blue-400 font-medium">Activa</span>
                                                            </div>
                                                        } @else {
                                                            <div class="flex items-center gap-1">
                                                                <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                                                                <span class="text-xs text-gray-500 dark:text-gray-400">Inactiva</span>
                                                            </div>
                                                        }
                                                    </div>

                                                    <!-- Usuario que creó la solicitud -->
                                                    <div class="flex items-center gap-2 text-xs text-surface-600 dark:text-surface-400">
                                                        <i class="pi pi-user-edit text-surface-400 w-3"></i>
                                                        <span>Por: <strong>{{ request.solusu }}</strong></span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Flecha indicadora -->
                                            <div class="flex items-center justify-center w-6 mt-2">
                                                <i class="pi pi-chevron-right text-surface-300 dark:text-surface-600 text-sm opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- Mensaje si no hay solicitudes -->
                            @if (filteredCustomers.length === 0) {
                                <div class="text-center py-12">
                                    <div class="relative">
                                        <!-- Background decorativo -->
                                        <div class="absolute inset-0 bg-gradient-to-br from-orange-100/30 via-transparent to-amber-200/20 dark:from-orange-800/20 dark:to-amber-900/30 rounded-3xl"></div>

                                        <!-- Contenido -->
                                        <div class="relative p-8">
                                            <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-orange-200 to-amber-300 dark:from-orange-700 dark:to-amber-800 rounded-2xl flex items-center justify-center border border-orange-300/60 dark:border-orange-600/60">
                                                <i class="pi pi-map text-2xl text-orange-600 dark:text-orange-300"></i>
                                            </div>
                                            <h6 class="text-surface-700 dark:text-surface-300 font-bold mb-2 text-sm">
                                                No se encontraron solicitudes
                                            </h6>
                                            <p class="text-surface-500 dark:text-surface-500 text-xs max-w-sm mx-auto leading-relaxed">
                                                No hay solicitudes de cambio de dirección disponibles
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Paginación -->
                        @if (!loadingCustomers && filteredCustomers.length > 0) {
                            <div class="p-3 border-t border-surface-200/60 dark:border-surface-700/60">
                                <p-paginator
                                    [rows]="itemsPerPage"
                                    [totalRecords]="filteredCustomers.length"
                                    [first]="first"
                                    (onPageChange)="onPageChange($event)"
                                    class="text-sm">
                                </p-paginator>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>

        <!-- Panel Derecho - Mapa -->
        <div class="w-full lg:flex-1 flex flex-col order-1 lg:order-2">
            <div class="flex flex-col flex-1 overflow-hidden h-80 sm:h-96 lg:h-full bg-white dark:bg-surface-900 border border-surface-200 dark:border-surface-700 rounded-lg shadow-sm">

                <!-- Header Principal -->
                <div class="flex flex-col gap-3 sm:gap-4 p-3 sm:p-4 border-b border-surface-200 dark:border-surface-700">

                    <!-- Título, descripción y acciones alineados -->
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 p-3 sm:p-4 bg-gradient-to-r from-surface-50 to-white dark:from-surface-900 dark:to-surface-800 rounded-lg border border-surface-200 dark:border-surface-700">

                        <!-- Bloque de icono + texto -->
                        <div class="flex items-center gap-2 min-w-0">
                            <div
                                class="w-12 h-12 flex items-center justify-center rounded-xl bg-gradient-to-br from-primary-100 via-primary-200/60 to-primary-300/40 dark:from-primary-900/50 dark:via-primary-800/70 dark:to-primary-700/50 border border-primary-200/60 dark:border-primary-600/40 shadow-lg">
                                <i class="pi pi-map-marker text-primary-600 dark:text-primary-300 text-xl"></i>
                            </div>
                            <div class="min-w-0">
                                <p class="text-gray-800 dark:text-white text-xl sm:text-2xl font-bold leading-snug tracking-tight">
                                    Cambio de Dirección
                                </p>
                                <p style="margin-top:-15px;" class="text-gray-500 dark:text-gray-400 text-xs sm:text-sm leading-snug">
                                    Solicitudes de actualización de ubicación de clientes
                                </p>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="flex gap-2 flex-shrink-0 items-center">
                            <button
                                class="flex items-center justify-center h-9 w-9 rounded-full bg-white dark:bg-surface-800 hover:bg-primary-50 dark:hover:bg-primary-900/30 shadow-sm border border-surface-200 dark:border-surface-700 transition-all duration-200"
                                (click)="refreshData()"
                                pTooltip="Restablecer vista"
                                tooltipPosition="bottom">
                                <i class="pi pi-refresh text-primary-500 dark:text-primary-400"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Panel de Detalle de Solicitud  -->
                    @if (selectedCustomer) {
                        <div class="relative p-3 bg-gradient-to-r from-blue-50/20 to-indigo-50/15 dark:from-blue-900/10 dark:to-indigo-900/15 rounded-lg border border-blue-200/60 dark:border-blue-700/40 shadow-sm">

                            <!-- Header: ID + Estados -->
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                <span class="inline-flex items-center px-2 py-0.5 rounded-md bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xs font-bold shadow-sm">
                                    #{{ selectedCustomer.solid }}
                                </span>

                                    @if (selectedCustomerDetail$ | async; as detail) {
                                        <!-- Estados al lado del ID -->
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border"
                                              [class]="detail.solapli
                                                ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-700'
                                                : 'bg-yellow-50 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 border-yellow-200 dark:border-yellow-700'">
                                            {{ detail.solapli ? 'Aplicado' : 'Pendiente' }}
                                        </span>

                                    }
                                </div>

                                <!-- Fecha + Usuario -->
                                <div class="text-right text-xs">
                                    @if (selectedCustomerDetail$ | async; as detail) {
                                        <div class="text-surface-600 dark:text-surface-400 font-medium">
                                            {{ detail.solfech | date:'dd/MM/yyyy HH:mm' }}
                                        </div>
                                        <div class="text-surface-500 dark:text-surface-500 mt-0.5">
                                            Por: {{ detail.solusu }}
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Loading compacto -->
                            @if (loadingCustomerDetail) {
                                <div class="flex items-center justify-center py-4">
                                    <i class="pi pi-spin pi-spinner text-blue-500 mr-2"></i>
                                    <span class="text-xs text-surface-600 dark:text-surface-400">Cargando...</span>
                                </div>
                            }

                            <!-- Contenido principal unificado -->
                            @if (selectedCustomerDetail$ | async; as detail) {
                                <div class="bg-white/80 dark:bg-surface-700/40 rounded-lg p-3 border border-surface-300/50 dark:border-surface-600/40 shadow-sm">

                                    <!-- Información del Cliente -->
                                    <div class="mb-3">
                                        <div class="flex items-center gap-1.5 mb-1.5">
                                            <i class="pi pi-user text-green-600 dark:text-green-400 text-xs"></i>
                                            <span class="text-xs font-medium text-green-700 dark:text-green-400">Cliente</span>
                                        </div>

                                        <div class="flex items-start justify-between gap-3">
                                            <div class="flex-1 min-w-0">
                                                <div class="flex items-center gap-3 flex-wrap">
                                                    <p class="text-sm font-semibold text-surface-900 dark:text-surface-0 leading-tight">
                                                        {{ detail.solnombre }}
                                                    </p>
                                                    <div class="flex items-center gap-1 mb-5">
                                                        <i class="pi pi-hashtag text-surface-500 dark:text-surface-400 text-xs"></i>
                                                        <p class="text-xs font-mono text-surface-600 dark:text-surface-400">
                                                            {{ detail.solruc }}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Botones de acciones -->
                                            <div class="flex items-center gap-1.5 flex-shrink-0">
                                                <p-button
                                                    icon="pi pi-times"
                                                    severity="danger"
                                                    size="small"
                                                    [text]="true"
                                                    [rounded]="true"
                                                    [loading]="loadingDesactivate"
                                                    class="!w-7 !h-7"
                                                    pTooltip="Anular solicitud"
                                                    tooltipPosition="top"
                                                    (click)="desactivateRequest(detail.solid)">
                                                </p-button>

                                                <p-button
                                                    icon="pi pi-check"
                                                    severity="success"
                                                    size="small"
                                                    [text]="true"
                                                    [rounded]="true"
                                                    [loading]="loadingAccept"
                                                    class="!w-7 !h-7"
                                                    pTooltip="Aceptar solicitud"
                                                    tooltipPosition="top"
                                                    (click)="acceptRequest(detail)">
                                                </p-button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Separador -->
                                    <div class="h-px bg-gradient-to-r from-transparent via-surface-300/50 dark:via-surface-600/50 to-transparent mb-3"></div>

                                    <!-- Cambio de Ubicación -->
                                    <div>

                                        <!-- Direcciones en flex horizontal -->
                                        <div class="flex items-center gap-2 mb-2">

                                            <!-- Dirección Anterior -->
                                            <div class="flex-1 min-w-0">
                                                <div class="flex items-center gap-1 mb-0.5">
                                                    <i class="pi pi-clock text-orange-500 dark:text-orange-400 text-xs"></i>
                                                    <span class="text-xs text-orange-600 dark:text-orange-400 font-medium">Anterior</span>
                                                </div>
                                                <p class="text-sm font-semibold text-surface-900 dark:text-surface-0 leading-tight truncate">
                                                    {{ detail.soldiran }}
                                                </p>
                                            </div>

                                            <!-- Flecha -->
                                            <div class="flex-shrink-0 px-1">
                                                <i class="pi pi-arrow-right text-purple-500 dark:text-purple-400 text-xs"></i>
                                            </div>

                                            <!-- Dirección Nueva -->
                                            <div class="flex-1 min-w-0">
                                                <div class="flex items-center gap-1 mb-0.5">
                                                    <i class="pi pi-check-circle text-green-500 dark:text-green-400 text-xs"></i>
                                                    <span class="text-xs text-green-600 dark:text-green-400 font-medium">Nueva</span>
                                                </div>
                                                <p class="text-sm font-semibold text-surface-900 dark:text-surface-0 leading-tight truncate">
                                                    {{ detail.soldirnu }}
                                                </p>
                                            </div>
                                        </div>

                                        <!-- Coordenadas -->
                                        <div class="pt-1.5 border-t border-surface-200/50 dark:border-surface-600/30">
                                            <p class="text-xs font-mono text-surface-500 dark:text-surface-400">
                                                {{ detail.sollat | number:'1.4-4' }}, {{ detail.sollog | number:'1.4-4' }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- Error state -->
                            @if (selectedCustomerDetail$ | async; as detail) {
                                @if (detail === null && !loadingCustomerDetail) {
                                    <div class="text-center py-3">
                                        <i class="pi pi-exclamation-triangle text-red-500 text-lg mb-1"></i>
                                        <p class="text-xs text-surface-600 dark:text-surface-400">Error al cargar detalle</p>
                                    </div>
                                }
                            }
                        </div>
                    }

                    <!-- Buscador de Ubicaciones -->
                    <div class="flex flex-col sm:flex-row gap-2">
                        <div class="flex-1 min-w-0">
                            <p-iconField iconPosition="left" class="w-full">
                                <p-inputIcon>
                                    <i class="pi pi-map-marker"></i>
                                </p-inputIcon>
                                <input
                                    pInputText
                                    type="text"
                                    placeholder="Buscar ubicación (ej: Quito, Ecuador)"
                                    [(ngModel)]="searchLocation"
                                    (keyup.enter)="searchLocationOnMap()"
                                    class="w-full text-sm">
                            </p-iconField>
                        </div>
                        <div class="flex gap-2 flex-shrink-0">
                            <p-button icon="pi pi-search"
                                      severity="primary"
                                      size="small"
                                      (click)="searchLocationOnMap()"
                                      [loading]="searchingLocation"
                                      pTooltip="Buscar ubicación"
                                      tooltipPosition="bottom">
                            </p-button>
                            <p-button icon="pi pi-times"
                                      severity="secondary"
                                      size="small"
                                      [text]="true"
                                      (click)="clearLocationSearch()"
                                      pTooltip="Limpiar búsqueda"
                                      tooltipPosition="bottom">
                            </p-button>
                        </div>
                    </div>

                    <!-- Resultados de búsqueda -->
                    @if (searchResults.length > 0) {
                        <div class="bg-surface-50 dark:bg-surface-800 rounded-lg p-3">
                            <div class="text-xs sm:text-sm text-surface-600 dark:text-surface-400 mb-2">
                                Resultados de búsqueda:
                            </div>
                            <div class="space-y-1">
                                @for (result of searchResults.slice(0, 3); track result) {
                                    <div
                                        class="flex items-center justify-between p-2 hover:bg-surface-100 dark:hover:bg-surface-700 rounded cursor-pointer transition-colors"
                                        (click)="selectSearchResult(result)">
                                        <div class="flex items-center gap-2 min-w-0 flex-1">
                                            <i class="pi pi-map-marker text-primary text-sm flex-shrink-0"></i>
                                            <span class="text-xs sm:text-sm text-surface-900 dark:text-surface-0 truncate">{{ result.display_name }}</span>
                                        </div>
                                        <i class="pi pi-arrow-right text-surface-400 text-xs flex-shrink-0 ml-2"></i>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>

                <!-- Contenedor del Mapa -->
                <div class="flex-1 relative overflow-hidden min-h-0">
                    <!-- Loading del mapa -->
                    @if (!mapInitialized) {
                        <div class="absolute inset-0 flex items-center justify-center bg-surface-100 dark:bg-surface-800 rounded-lg z-10">
                            <div class="text-center p-4">
                                <i class="pi pi-spin pi-spinner text-2xl text-primary mb-2"></i>
                                <p class="text-sm sm:text-base text-surface-600 dark:text-surface-400">Cargando mapa...</p>
                            </div>
                        </div>
                    }
                    <!-- Mapa de Leaflet -->
                    <div #mapContainer
                         class="w-full h-full rounded-lg"
                         style="min-height: 700px; height: 100%; width: 100%;">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
